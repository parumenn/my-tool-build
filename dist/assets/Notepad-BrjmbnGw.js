import{j as t}from"./index-A0BsTpgX.js";import{r as o,a as G}from"./vendor-react-Dy8mW7IA.js";import{b3 as Z,b4 as I,Y as ee,b5 as te,b6 as re,b7 as ne,b8 as oe,p as ae,b9 as se,aD as M,s as le,ba as ie,bb as ce}from"./vendor-ui-BTIjoA30.js";import"./vendor-utils-V9s-2EHj.js";const de=[{color:"#000000",label:"黒"},{color:"#4B5563",label:"グレー"},{color:"#EF4444",label:"赤"},{color:"#F59E0B",label:"オレンジ"},{color:"#10B981",label:"緑"},{color:"#3B82F6",label:"青"},{color:"#8B5CF6",label:"紫"}],be=()=>{var _;const[g,k]=o.useState(()=>{const e=localStorage.getItem("maitool_notes");return e?JSON.parse(e):[{id:"1",title:"Welcome Note",content:`<div><b>ようこそ！</b></div><div>高機能なオンラインメモ帳へ。</div><ul><li>リッチテキスト対応</li><li>Tabキーでインデント</li></ul><pre><code>// コードブロック (自動検出)
console.log("Hello World");</code></pre>`,updated:new Date().toLocaleString()}]}),[u,j]=o.useState(((_=g[0])==null?void 0:_.id)||""),[v,m]=o.useState(!1),[N,F]=o.useState(null),[D,p]=o.useState(!0),[O,C]=o.useState(!1),[z,S]=o.useState(""),[w,P]=o.useState(""),L=o.useRef(null),d=o.useRef(null),A=o.useRef(null),E=o.useRef(null),x=o.useRef(null);o.useEffect(()=>{localStorage.setItem("maitool_notes",JSON.stringify(g))},[g]),o.useEffect(()=>{if(d.current){const e=g.find(r=>r.id===u);e?d.current.innerHTML!==e.content&&(d.current.innerHTML=e.content,requestAnimationFrame(()=>R(!0))):d.current.innerHTML=""}p(!u)},[u]),o.useEffect(()=>(x.current&&clearTimeout(x.current),x.current=window.setTimeout(()=>{R(!1)},1e3),()=>{x.current&&clearTimeout(x.current)}),[g]),o.useEffect(()=>{const e=()=>{v&&m(!1)};return window.addEventListener("scroll",e,!0),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e,!0),window.removeEventListener("resize",e)}},[v]);const B=g.find(e=>e.id===u),$=e=>{k(r=>r.map(n=>n.id===u?{...n,title:e,updated:new Date().toLocaleString()}:n))},y=()=>{if(d.current){const e=d.current.innerHTML;E.current&&clearTimeout(E.current),E.current=window.setTimeout(()=>{k(r=>r.map(n=>n.id===u?{...n,content:e,updated:new Date().toLocaleString()}:n))},1e3)}},q=e=>{let r=e;for(;r&&r!==d.current;){if(r.nodeType===1&&["DIV","P","LI","H1","H2","H3","BLOCKQUOTE","PRE","DETAILS"].includes(r.tagName))return r;r=r.parentNode}return null},W=()=>{const e=window.getSelection();e&&e.rangeCount>0&&(L.current=e.getRangeAt(0).cloneRange())},U=()=>{const e=window.getSelection();e&&L.current&&(e.removeAllRanges(),e.addRange(L.current))},R=(e=!1)=>{if(d.current&&window.hljs){const r=d.current.querySelectorAll("pre code"),n=window.getSelection();r.forEach(a=>{var i;const l=a;let h=!1;if(!e&&n&&n.anchorNode&&((i=d.current)!=null&&i.contains(n.anchorNode))&&(h=a.contains(n.anchorNode)),!h){const s=l.innerText;try{const b=window.hljs.highlightAuto(s);let c=b.value;s.endsWith(`
`)&&!c.endsWith(`
`)&&(c+=`
`),l.innerHTML=c,l.className="hljs "+b.language}catch{l.textContent=s}}})}},H=e=>{const r=document.createElement("div");r.innerHTML="<br>",e.after(r);const n=window.getSelection(),a=document.createRange();a.setStart(r,0),a.collapse(!0),n&&(n.removeAllRanges(),n.addRange(a)),y()},K=e=>{if(!e.nativeEvent.isComposing&&e.key==="Enter"&&!e.shiftKey){const r=window.getSelection();if(!r||!r.rangeCount)return;const n=r.getRangeAt(0);let a=n.startContainer;a.nodeType===3&&(a=a.parentNode);const l=a.closest("pre");if(l){x.current&&clearTimeout(x.current),x.current=window.setTimeout(()=>R(!1),2e3);const i=document.createRange();if(i.setStart(n.endContainer,n.endOffset),i.setEndAfter(l),i.toString().replace(/[\r\n]/g,"").length===0){const c=document.createRange();c.selectNodeContents(l),c.setEnd(n.startContainer,n.startOffset);const T=c.toString();if(T.endsWith(`
`)||T.endsWith("\r")){e.preventDefault(),l.innerText=l.innerText.replace(/[\r\n]+$/,""),H(l);return}}return}const h=a.closest("details");if(h){const i=h.querySelector(".toggle-content");if(i&&(i.contains(n.startContainer)||i===n.startContainer)){let s=q(n.startContainer);for(;s&&s.parentElement!==i&&s!==i;)s=s.parentElement;if(s&&s.parentElement===i){let b=!0,c=s.nextSibling;for(;c;){if(c.textContent&&c.textContent.replace(/[\n\r]/g,"").length>0){b=!1;break}c=c.nextSibling}if(b&&(s.textContent||"").trim()===""){e.preventDefault(),s.remove(),H(h);return}}}}}},Q=e=>{const r=e.clipboardData.getData("text/plain");/^(http|https):\/\/[^ "]+$/.test(r)&&(e.preventDefault(),document.execCommand("insertHTML",!1,`<a href="${r}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">${r}</a>`),y())},V=()=>{const e=Date.now().toString(),r={id:e,title:"無題のメモ",content:"<div></div>",updated:new Date().toLocaleString()};k([r,...g]),j(e),p(!1)},J=(e,r)=>{var n;if(r.stopPropagation(),confirm("このメモを削除しますか？")){const a=g.filter(l=>l.id!==e);k(a),u===e&&(j(((n=a[0])==null?void 0:n.id)||""),p(!0))}},f=(e,r=void 0)=>{var n;document.execCommand(e,!1,r),(n=d.current)==null||n.focus(),y()},X=()=>{if(U(),w){const e=`<a href="${w}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">${z||w}</a>`;document.execCommand("insertHTML",!1,e),y()}C(!1),S(""),P("")},Y=()=>{W();const e=window.getSelection();e&&!e.isCollapsed&&S(e.toString()),C(!0)};return t.jsxs("div",{className:"max-w-6xl mx-auto space-y-4 h-[calc(100vh-140px)] flex flex-col pb-4",children:[t.jsxs("div",{className:"flex-1 bg-white dark:bg-dark-lighter rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden flex",children:[t.jsxs("div",{className:`w-full md:w-64 bg-gray-50 dark:bg-gray-900 border-r border-gray-100 dark:border-gray-800 flex flex-col ${D?"block":"hidden md:flex"}`,children:[t.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center bg-white dark:bg-gray-900",children:[t.jsxs("h3",{className:"font-black text-gray-700 dark:text-white flex items-center gap-2",children:[t.jsx(Z,{size:18})," メモ一覧"]}),t.jsx("button",{onClick:V,className:"p-2 bg-lime-500 text-white rounded-lg hover:bg-lime-600 transition-colors shadow-lg shadow-lime-200 dark:shadow-none",children:t.jsx(I,{size:18})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:g.map(e=>t.jsxs("div",{onClick:()=>j(e.id),className:`p-3 rounded-xl cursor-pointer transition-all border ${u===e.id?"bg-white dark:bg-gray-700 border-lime-500 shadow-md":"bg-transparent border-transparent hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-1",children:[t.jsx("h4",{className:`font-bold text-sm truncate ${u===e.id?"text-lime-700 dark:text-lime-400":"text-gray-700 dark:text-gray-300"}`,children:e.title||"無題のメモ"}),t.jsx("button",{onClick:r=>J(e.id,r),className:"text-gray-400 hover:text-red-500 p-1",children:t.jsx(ee,{size:14})})]}),t.jsx("p",{className:"text-[10px] text-gray-400",children:e.updated})]},e.id))})]}),t.jsx("div",{className:`flex-1 flex flex-col min-w-0 bg-white dark:bg-dark-lighter ${D?"hidden md:flex":"block"}`,children:B?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-2 md:p-4 border-b border-gray-100 dark:border-gray-800 flex items-center gap-2 md:gap-4 shrink-0 overflow-x-auto no-scrollbar",children:[t.jsx("button",{onClick:()=>p(!0),className:"md:hidden p-2 text-gray-500",children:t.jsx(te,{size:20})}),t.jsx("input",{type:"text",value:B.title,onChange:e=>$(e.target.value),className:"flex-1 text-lg font-bold bg-transparent outline-none dark:text-white min-w-[100px]",placeholder:"タイトルを入力..."}),t.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-800 p-1 rounded-xl",children:[t.jsx("button",{onClick:()=>f("bold"),className:"p-2 rounded-lg hover:bg-white dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",title:"太字",children:t.jsx(re,{size:16})}),t.jsx("button",{onClick:()=>f("formatBlock","H2"),className:"p-2 rounded-lg hover:bg-white dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",title:"見出し",children:t.jsx(ne,{size:16})}),t.jsx("button",{onClick:()=>f("insertUnorderedList"),className:"p-2 rounded-lg hover:bg-white dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",title:"リスト",children:t.jsx(oe,{size:16})}),t.jsx("button",{onClick:()=>f("formatBlock","PRE"),className:"p-2 rounded-lg hover:bg-white dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",title:"コード",children:t.jsx(ae,{size:16})}),t.jsx("button",{onClick:()=>f("formatBlock","BLOCKQUOTE"),className:"p-2 rounded-lg hover:bg-white dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",title:"引用",children:t.jsx(se,{size:16})}),t.jsx("button",{onClick:Y,className:"p-2 rounded-lg hover:bg-white dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",title:"リンク",children:t.jsx(M,{size:16})}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{ref:A,onClick:()=>{var r;const e=(r=A.current)==null?void 0:r.getBoundingClientRect();e&&F({top:e.bottom+5,left:e.left}),m(!v)},className:"p-2 rounded-lg hover:bg-white dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors flex items-center gap-1",children:[t.jsx(le,{size:16})," ",t.jsx(ie,{size:12})]}),v&&N&&G.createPortal(t.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 shadow-xl rounded-xl p-3 border border-gray-100 dark:border-gray-700 grid grid-cols-4 gap-2 z-[9999]",style:{top:N.top,left:N.left},onMouseLeave:()=>m(!1),children:[de.map(e=>t.jsx("button",{onClick:()=>{f("foreColor",e.color),m(!1)},className:"w-6 h-6 rounded-full border border-gray-200 hover:scale-110 transition-transform",style:{backgroundColor:e.color},title:e.label},e.color)),t.jsx("button",{onClick:()=>{f("removeFormat"),m(!1)},className:"w-6 h-6 rounded-full border border-gray-200 hover:scale-110 transition-transform flex items-center justify-center text-gray-400",title:"書式クリア",children:t.jsx(ce,{size:12})})]}),document.body)]})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto relative",children:t.jsx("div",{ref:d,contentEditable:!0,suppressContentEditableWarning:!0,className:"w-full h-full p-6 outline-none prose dark:prose-invert max-w-none [&_pre]:bg-gray-800 [&_pre]:text-white [&_pre]:p-4 [&_pre]:rounded-lg [&_blockquote]:border-l-4 [&_blockquote]:border-gray-300 [&_blockquote]:pl-4 [&_blockquote]:italic",onInput:y,onKeyDown:K,onPaste:Q})})]}):t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:t.jsx(I,{size:32})}),t.jsx("p",{className:"font-bold",children:"メモを選択するか、新規作成してください"})]})})]}),O&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-sm border border-gray-100 dark:border-gray-700 animate-scale-up",children:[t.jsxs("h3",{className:"font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(M,{size:18})," リンクを挿入"]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"表示テキスト"}),t.jsx("input",{type:"text",value:z,onChange:e=>S(e.target.value),className:"w-full p-3 rounded-xl border bg-gray-50 dark:bg-gray-900 dark:border-gray-700 text-sm",placeholder:"リンクのタイトル"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"URL"}),t.jsx("input",{type:"text",value:w,onChange:e=>P(e.target.value),className:"w-full p-3 rounded-xl border bg-gray-50 dark:bg-gray-900 dark:border-gray-700 text-sm",placeholder:"https://example.com",autoFocus:!0})]}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsx("button",{onClick:()=>C(!1),className:"flex-1 py-2.5 text-gray-500 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",children:"キャンセル"}),t.jsx("button",{onClick:X,disabled:!w,className:"flex-1 py-2.5 bg-lime-500 text-white font-bold rounded-xl hover:bg-lime-600 disabled:opacity-50 transition-colors shadow-lg shadow-lime-200 dark:shadow-none",children:"挿入"})]})]})]})})]})};export{be as default};
